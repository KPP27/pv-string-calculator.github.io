<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PV String Calculator</title>

<style>
  body {
    font-family: Arial, sans-serif;
    background: #f5f7fa;
    padding: 20px;
    max-width: 420px;
    margin: auto;
  }

  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  h2 {
    margin: 0;
    font-size: 20px;
  }

  .lang-switch {
    display: flex;
    gap: 5px;
  }

  .lang-btn {
    padding: 5px 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
    background: #fff;
    cursor: pointer;
    font-size: 12px;
    transition: 0.2s;
  }

  .lang-btn.active {
    background: #4a6cf7;
    color: white;
    border-color: #4a6cf7;
  }

  input {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    box-sizing: border-box;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 14px;
    transition: 0.3s;
  }

  input:focus {
    border-color: #4a6cf7;
    box-shadow: 0 0 6px rgba(74,108,247,0.3);
  }

  button {
    padding: 14px;
    width: 100%;
    margin-top: 15px;
    border: none;
    background: #4a6cf7;
    color: white;
    border-radius: 10px;
    font-size: 16px;
    cursor: pointer;
    transition: 0.3s;
  }

  button:hover {
    background: #3a59d4;
  }

  .result {
    margin-top: 20px;
    font-weight: bold;
    font-size: 18px;
    animation: fadeIn 0.4s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(5px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
</head>

<body>

<div class="header">
  <h2 id="title">Калькулятор количества фотомодулей</h2>

  <div class="lang-switch">
    <div class="lang-btn" data-lang="ru">RU</div>
    <div class="lang-btn" data-lang="ua">UA</div>
    <div class="lang-btn" data-lang="en">EN</div>
    <div class="lang-btn" data-lang="pl">PL</div>
  </div>
</div>

<input type="number" id="E13" placeholder="Максимально допустимое напряжение DC на входе инвертора">
<input type="number" id="E14" placeholder="Voc фотомодуля (STC)">
<input type="number" id="E15" placeholder="Минимальная температура">
<input type="number" id="E16" placeholder="Температурный коэффициент Voc (%)">

<button id="calcBtn">Рассчитать</button>

<div class="result" id="result"></div>

<script>
const translations = {
  ru: {
    title: "Калькулятор количества фотомодулей",
    phE13: "Максимально допустимое напряжение DC на входе инвертора",
    phE14: "Voc фотомодуля (STC)",
    phE15: "Минимальная температура",
    phE16: "Температурный коэффициент Voc (%)",
    calc: "Рассчитать",
    error: "Пожалуйста, заполните все поля",
    result: "Максимальное количество фотомодулей: "
  },
  ua: {
    title: "Калькулятор кількості фотомодулів",
    phE13: "Максимальна допустима напруга DC інвертора",
    phE14: "Voc фотомодуля (STC)",
    phE15: "Мінімальна температура",
    phE16: "Температурний коефіцієнт Voc (%)",
    calc: "Розрахувати",
    error: "Будь ласка, заповніть всі поля",
    result: "Максимальна кількість фотомодулів: "
  },
  en: {
    title: "PV Module Count Calculator",
    phE13: "Max DC inverter voltage",
    phE14: "Module Voc (STC)",
    phE15: "Minimum temperature",
    phE16: "Temperature coefficient Voc (%)",
    calc: "Calculate",
    error: "Please fill in all fields",
    result: "Maximum number of modules: "
  },
  pl: {
    title: "Kalkulator liczby modułów PV",
    phE13: "Maksymalne dopuszczalne napięcie DC falownika",
    phE14: "Voc modułu (STC)",
    phE15: "Minimalna temperatura",
    phE16: "Współczynnik temperaturowy Voc (%)",
    calc: "Oblicz",
    error: "Proszę wypełnić wszystkie pola",
    result: "Maksymalna liczba modułów: "
  }
};

function applyLang(lang) {
  localStorage.setItem("lang", lang);
  const t = translations[lang];

  document.getElementById("title").textContent = t.title;
  document.getElementById("E13").placeholder = t.phE13;
  document.getElementById("E14").placeholder = t.phE14;
  document.getElementById("E15").placeholder = t.phE15;
  document.getElementById("E16").placeholder = t.phE16;
  document.getElementById("calcBtn").textContent = t.calc;

  document.querySelectorAll(".lang-btn").forEach(btn =>
    btn.classList.toggle("active", btn.dataset.lang === lang)
  );
}

document.querySelectorAll(".lang-btn").forEach(btn => {
  btn.onclick = () => applyLang(btn.dataset.lang);
});

// auto-language detection (Telegram WebApp)
try {
  const tgLang = window.Telegram.WebApp.initDataUnsafe.user.language_code;
  if (tgLang && translations[tgLang.slice(0,2)]) {
    applyLang(tgLang.slice(0,2));
  }
} catch {}

// load saved language
applyLang(localStorage.getItem("lang") || "ru");

document.getElementById("calcBtn").onclick = function () {
    const lang = localStorage.getItem("lang") || "ru";
    const t = translations[lang];

    let E13 = parseFloat(E13.value);
    let E14 = parseFloat(E14.value);
    let E15 = parseFloat(E15.value);
    let E16 = parseFloat(E16.value);

    if (!E13 || !E14 || !E15 || !E16) {
        result.innerText = t.error;
        return;
    }

    let count = Math.floor(E13 / (E14 * (1 + (E15 - 25) * E16 / 100)));
    result.innerText = t.result + count + " шт.";
};
</script>

</body>
</html>
